<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL AR</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-three.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        #language-switch { position: fixed; top: 10px; right: 10px; background: white; padding: 10px; cursor: pointer; }
        #fact-box { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.8); color: white; padding: 10px; display: none; }
    </style>
</head>
<body>

    <div id="language-switch">Switch to Maltese</div>
    <div id="fact-box">Tap the object for a fact</div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            // MindAR setup
            const mindarThree = new window.MINDAR.IMAGE.MindARThree({
                container: document.body,
                imageTargetSrc: "cannon.mind", // Replace with your MindAR marker file
            });

            const { renderer, scene, camera } = mindarThree;
            const anchor = mindarThree.addAnchor(0); // Track first detected image

            // Load 3D Model
            const loader = new THREE.GLTFLoader();
            let model;
            loader.load("cannon.glb", (gltf) => { // Replace with your model path
                model = gltf.scene;
                model.scale.set(0.5, 0.5, 0.5);
                model.position.set(0, 0, 0);
                anchor.group.add(model);
            });

            // Touch Interactions (Rotation & Scaling)
            let lastX = 0, lastY = 0, scale = 1;
            document.body.addEventListener("touchstart", (event) => {
                if (event.touches.length === 1) {
                    lastX = event.touches[0].clientX;
                    lastY = event.touches[0].clientY;
                }
            });

            document.body.addEventListener("touchmove", (event) => {
                if (event.touches.length === 1 && model) {
                    let deltaX = event.touches[0].clientX - lastX;
                    let deltaY = event.touches[0].clientY - lastY;
                    model.rotation.y += deltaX * 0.01;
                    model.rotation.x += deltaY * 0.01;
                    lastX = event.touches[0].clientX;
                    lastY = event.touches[0].clientY;
                } else if (event.touches.length === 2 && model) {
                    let dist = Math.hypot(
                        event.touches[0].clientX - event.touches[1].clientX,
                        event.touches[0].clientY - event.touches[1].clientY
                    );
                    scale = dist / 200;
                    model.scale.set(scale, scale, scale);
                }
            });

            // Language & Fact Display
            const languageSwitch = document.getElementById("language-switch");
            const factBox = document.getElementById("fact-box");
            let isEnglish = true;

            const facts = {
                english: "This is an ancient Maltese artifact.",
                maltese: "Dan huwa artifatt antik Malti."
            };

            model?.addEventListener("click", () => {
                factBox.innerText = isEnglish ? facts.english : facts.maltese;
                factBox.style.display = "block";
                setTimeout(() => { factBox.style.display = "none"; }, 3000);
            });

            languageSwitch.addEventListener("click", () => {
                isEnglish = !isEnglish;
                languageSwitch.innerText = isEnglish ? "Switch to Maltese" : "Switch to English";
            });

            // Start AR Session
            await mindarThree.start();
            renderer.setAnimationLoop(() => { renderer.render(scene, camera); });
        });
    </script>

</body>
</html>